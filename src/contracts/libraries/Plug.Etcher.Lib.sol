// SPDX-License-Identifier: MIT

pragma solidity 0.8.23;

import { PlugLib } from "../libraries/Plug.Lib.sol";
import { PlugFactory } from "../base/Plug.Factory.sol";
import { PlugTreasury } from "../base/Plug.Treasury.sol";
import { PlugVaultSocket } from "../sockets/Plug.Vault.Socket.sol";
import { Plug } from "../base/Plug.sol";

interface ImmutableCreate2Factory {
    function safeCreate2(
        bytes32 salt,
        bytes calldata initCode
    )
        external
        payable
        returns (address deploymentAddress);

    function findCreate2Address(
        bytes32 salt,
        bytes calldata initCode
    )
        external
        view
        returns (address deploymentAddress);

    function findCreate2AddressViaHash(
        bytes32 salt,
        bytes32 initCodeHash
    )
        external
        view
        returns (address deploymentAddress);
}

/**
 * @title Plug Etcher
 * @notice This contract is the basis of the automatically generated Plug Etcher
 *         contract used to deploy and write the proper addresses. If you need to add
 *         a new etch into the vm stack for testing, you will do so through the file
 *         found at: /lib/functions/etcher.ts
 * @notice A good portion of this model comes from:
 *         https://github.com/Vectorized/multicaller/blob/main/src/MulticallerEtcher.sol
 *         I am not a Foundry expert. If there is a better way to do this, please let me
 *         know because this is a lot of work just to get a contract deployed when you're
 *         doing anything more than a simple in-and-out contract.
 * @author vectorized (twitter:@optimizoor)
 */
library PlugEtcherLib {
    /// @notice The immutable Create2 factory used for deployment.
    ImmutableCreate2Factory internal constant FACTORY =
        ImmutableCreate2Factory(0x0000000000FFe8B47B3e2130213B802212439497);

    bytes internal constant PLUG_FACTORY_INITCODE =
        hex"608060405234801561001057600080fd5b5061001b6001610020565b61005c565b6001600160a01b0316638b78c6d8198190558060007f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e08180a350565b610b918061006b6000396000f3fe6080604052600436106100d25760003560e01c80637bb7c0d81161007f578063d225540311610059578063d2255403146102af578063f04e283e146102cf578063f2fde38b146102e2578063fee81cf4146102f557600080fd5b80637bb7c0d8146102185780638bdb20d4146102385780638da5cb5b1461027b57600080fd5b8063715018a6116100b0578063715018a61461012d57806375fd9f28146101355780637ac4ed64146101d357600080fd5b806325692962146100d75780632b85ba38146100e157806354d1f13d14610125575b600080fd5b6100df610328565b005b6100f46100ef36600461097e565b610378565b60408051921515835273ffffffffffffffffffffffffffffffffffffffff9091166020830152015b60405180910390f35b6100df6104da565b6100df610516565b34801561014157600080fd5b506101c56101503660046109c0565b604080517fcc3735a920a3ca505d382bbc545af43d6000803e6038573d6000fd5b3d6000f360609081527f5155f3363d3d373d3d363d7f360894a13ba1a3210667c828492db98dca3e20768352616009602052601e9390935268603d3d8160223d3973600a52605f6021209152600090915290565b60405190815260200161011c565b3480156101df57600080fd5b506101f36101ee3660046109db565b61052a565b60405173ffffffffffffffffffffffffffffffffffffffff909116815260200161011c565b34801561022457600080fd5b506100df610233366004610a34565b61053e565b34801561024457600080fd5b506101f3610253366004610b36565b60006020819052908152604090205473ffffffffffffffffffffffffffffffffffffffff1681565b34801561028757600080fd5b507fffffffffffffffffffffffffffffffffffffffffffffffffffffffff74873927546101f3565b3480156102bb57600080fd5b506100df6102ca366004610b51565b6105b7565b6100df6102dd3660046109c0565b61067f565b6100df6102f03660046109c0565b6106bf565b34801561030157600080fd5b506101c56103103660046109c0565b63389a75e1600c908152600091909152602090205490565b60006202a30067ffffffffffffffff164201905063389a75e1600c5233600052806020600c2055337fdbf36a107da19e49527a7176a1babf963b4b0ff8cde35ee35d6cd8f1f9ac7e1d600080a250565b61ffff81166000908152602081905260408120548190839073ffffffffffffffffffffffffffffffffffffffff16806103e8576040517faee5b44400000000000000000000000000000000000000000000000000000000815261ffff831660048201526024015b60405180910390fd5b6103f33482876106e6565b9094509250836104d357604051858152606086901c90819073ffffffffffffffffffffffffffffffffffffffff8416907f32c7564be3bbeabe66360c08d019367b0d744fcb948046d92552c00c9743dd109060200160405180910390a36040517fc4d66de800000000000000000000000000000000000000000000000000000000815273ffffffffffffffffffffffffffffffffffffffff828116600483015285169063c4d66de890602401600060405180830381600087803b1580156104b957600080fd5b505af11580156104cd573d6000803e3d6000fd5b50505050505b5050915091565b63389a75e1600c523360005260006020600c2055337ffa7b8eab7da67f412cc9575ed43464468f9bfbae89d1675917346ca6d8fe3c92600080a2565b61051e6107ca565b6105286000610800565b565b6000610537838330610866565b9392505050565b610547836108f8565b60008080526020527fad3228b676f7d3cd4284a5443f17f1962b36e491b30a40b2405849e597ba5fb580547fffffffffffffffffffffffff00000000000000000000000000000000000000001673ffffffffffffffffffffffffffffffffffffffff929092169190911790555050565b6105bf6107ca565b61ffff821660009081526020819052604090205473ffffffffffffffffffffffffffffffffffffffff1615610626576040517fb951c9df00000000000000000000000000000000000000000000000000000000815261ffff831660048201526024016103df565b61ffff91909116600090815260208190526040902080547fffffffffffffffffffffffff00000000000000000000000000000000000000001673ffffffffffffffffffffffffffffffffffffffff909216919091179055565b6106876107ca565b63389a75e1600c52806000526020600c2080544211156106af57636f5e88186000526004601cfd5b600090556106bc81610800565b50565b6106c76107ca565b8060601b6106dd57637448fbae6000526004601cfd5b6106bc81610800565b6000806040517fcc3735a920a3ca505d382bbc545af43d6000803e6038573d6000fd5b3d6000f36060527f5155f3363d3d373d3d363d7f360894a13ba1a3210667c828492db98dca3e207660405261600960205284601e5268603d3d8160223d3973600a52605f60212060358201523060581b815260ff8153836015820152605581209150813b6107925783605f602188f591508161078d5763301164256000526004601cfd5b6107b8565b6001925085156107b85760003860003889865af16107b85763b12d13eb6000526004601cfd5b80604052506000606052935093915050565b7fffffffffffffffffffffffffffffffffffffffffffffffffffffffff74873927543314610528576382b429006000526004601cfd5b7fffffffffffffffffffffffffffffffffffffffffffffffffffffffff74873927805473ffffffffffffffffffffffffffffffffffffffff9092169182907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e0600080a355565b6000806108e285604080517fcc3735a920a3ca505d382bbc545af43d6000803e6038573d6000fd5b3d6000f360609081527f5155f3363d3d373d3d363d7f360894a13ba1a3210667c828492db98dca3e20768352616009602052601e9390935268603d3d8160223d3973600a52605f6021209152600090915290565b90506108ef81858561095c565b95945050505050565b73ffffffffffffffffffffffffffffffffffffffff167fffffffffffffffffffffffffffffffffffffffffffffffffffffffff748739278190558060007f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e08180a350565b600060ff60005350603592835260601b60015260155260556000908120915290565b60006020828403121561099057600080fd5b5035919050565b803573ffffffffffffffffffffffffffffffffffffffff811681146109bb57600080fd5b919050565b6000602082840312156109d257600080fd5b61053782610997565b600080604083850312156109ee57600080fd5b6109f783610997565b946020939093013593505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b600080600060608486031215610a4957600080fd5b610a5284610997565b9250602084013567ffffffffffffffff80821115610a6f57600080fd5b818601915086601f830112610a8357600080fd5b813581811115610a9557610a95610a05565b604051601f82017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0908116603f01168101908382118183101715610adb57610adb610a05565b81604052828152896020848701011115610af457600080fd5b826020860160208301376000602084830101528096505050505050610b1b60408501610997565b90509250925092565b803561ffff811681146109bb57600080fd5b600060208284031215610b4857600080fd5b61053782610b24565b60008060408385031215610b6457600080fd5b610b6d83610b24565b9150610b7b60208401610997565b9050925092905056fea164736f6c6343000817000a";

    bytes32 internal constant PLUG_FACTORY_SALT =
        0x0000000000000000000000000000000000000000f113619cd2f8ff3f4f989f75;

    address internal constant PLUG_FACTORY_ADDRESS = 0x0036E76D47ab763104bB03d400973DB646838fAd;

    bytes internal constant PLUG_TREASURY_INITCODE =
        hex"608060405234801561001057600080fd5b50611c9f806100206000396000f3fe6080604052600436106100f75760003560e01c8063baa721001161008a578063dc556e3d11610059578063dc556e3d14610297578063f04e283e146102aa578063f2fde38b146102bd578063fee81cf4146102d0576100fe565b8063baa721001461023e578063c4d66de814610251578063d57b73c714610271578063d95316af14610284576100fe565b80635f67eebf116100c65780635f67eebf14610194578063715018a6146101b45780638da5cb5b146101bc578063a516a5bf14610210576100fe565b8063256929621461012c578063405135621461013457806354d1f13d14610147578063558bf9141461014f576100fe565b366100fe57005b60003560e01c63bc197c81811463f23a6e6182141763150b7a028214171561012a57806020526020603cf35b005b61012a610311565b61012a6101423660046116b3565b610361565b61012a610646565b34801561015b57600080fd5b5061017f61016a366004611720565b60006020819052908152604090205460ff1681565b60405190151581526020015b60405180910390f35b3480156101a057600080fd5b5061012a6101af366004611789565b610682565b61012a610721565b3480156101c857600080fd5b507fffffffffffffffffffffffffffffffffffffffffffffffffffffffff748739275460405173ffffffffffffffffffffffffffffffffffffffff909116815260200161018b565b34801561021c57600080fd5b5061023061022b3660046117e5565b610735565b60405161018b9291906118e3565b61012a61024c36600461199b565b6108fe565b34801561025d57600080fd5b5061012a61026c366004611720565b610b10565b61012a61027f366004611a12565b610b1c565b61012a61029236600461199b565b610e9d565b61012a6102a5366004611a9d565b611145565b61012a6102b8366004611720565b611277565b61012a6102cb366004611720565b6112b4565b3480156102dc57600080fd5b506103036102eb366004611720565b63389a75e1600c908152600091909152602090205490565b60405190815260200161018b565b60006202a30067ffffffffffffffff164201905063389a75e1600c5233600052806020600c2055337fdbf36a107da19e49527a7176a1babf963b4b0ff8cde35ee35d6cd8f1f9ac7e1d600080a250565b3068929eee149b4bd2126854036103805763ab143c066000526004601cfd5b3068929eee149b4bd212685573ffffffffffffffffffffffffffffffffffffffff8416600090815260208190526040812054859160ff909116151590036103f3576040517f0368cdc700000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b60006103ff3447611b28565b9050600061040d8434611b28565b6040517f70a08231000000000000000000000000000000000000000000000000000000008152306004820152909150889060009073ffffffffffffffffffffffffffffffffffffffff8316906370a0823190602401602060405180830381865afa15801561047f573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906104a39190611b41565b90506000808a73ffffffffffffffffffffffffffffffffffffffff16858b8b6040516104d0929190611b5a565b60006040518083038185875af1925050503d806000811461050d576040519150601f19603f3d011682016040523d82523d6000602084013e610512565b606091505b509150915061052182826112db565b6040517f70a0823100000000000000000000000000000000000000000000000000000000815230600482015260009073ffffffffffffffffffffffffffffffffffffffff8616906370a0823190602401602060405180830381865afa15801561058e573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906105b29190611b41565b90508084106105ed576040517fa1d4e4dd00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b6106018d336105fc8785611b28565b6112ed565b600061060d8a47611b28565b90508781111561062a5761062a336106258a84611b28565b61133c565b5050505050505050503868929eee149b4bd21268555050505050565b63389a75e1600c523360005260006020600c2055337ffa7b8eab7da67f412cc9575ed43464468f9bfbae89d1675917346ca6d8fe3c92600080a2565b61068a611358565b60005b8281101561071b57816000808686858181106106ab576106ab611b6a565b90506020020160208101906106c09190611720565b73ffffffffffffffffffffffffffffffffffffffff168152602081019190915260400160002080547fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff001691151591909117905560010161068d565b50505050565b610729611358565b610733600061138e565b565b606080610740611358565b868067ffffffffffffffff81111561075a5761075a611b99565b604051908082528060200260200182016040528015610783578160200160208202803683370190505b5092508067ffffffffffffffff81111561079f5761079f611b99565b6040519080825280602002602001820160405280156107d257816020015b60608152602001906001900390816107bd5790505b50915060005b818110156108f1578989828181106107f2576107f2611b6a565b90506020020160208101906108079190611720565b73ffffffffffffffffffffffffffffffffffffffff1688888381811061082f5761082f611b6a565b9050602002013587878481811061084857610848611b6a565b905060200281019061085a9190611bc8565b604051610868929190611b5a565b60006040518083038185875af1925050503d80600081146108a5576040519150601f19603f3d011682016040523d82523d6000602084013e6108aa565b606091505b508583815181106108bd576108bd611b6a565b602002602001018584815181106108d6576108d6611b6a565b602090810291909101019190915290151590526001016107d8565b5050965096945050505050565b3068929eee149b4bd21268540361091d5763ab143c066000526004601cfd5b3068929eee149b4bd212685573ffffffffffffffffffffffffffffffffffffffff8516600090815260208190526040812054869160ff90911615159003610990576040517f0368cdc700000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b61099c873330866113fd565b6109b087876109ab8587611b28565b61145a565b6000808773ffffffffffffffffffffffffffffffffffffffff163488886040516109db929190611b5a565b60006040518083038185875af1925050503d8060008114610a18576040519150601f19603f3d011682016040523d82523d6000602084013e610a1d565b606091505b5091509150610a2c82826112db565b6040517fdd62ed3e00000000000000000000000000000000000000000000000000000000815230600482015273ffffffffffffffffffffffffffffffffffffffff89811660248301528a169063dd62ed3e90604401602060405180830381865afa158015610a9e573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610ac29190611b41565b15610af9576040517f9d3e187d00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b5050503868929eee149b4bd2126855505050505050565b610b198161149f565b50565b3068929eee149b4bd212685403610b3b5763ab143c066000526004601cfd5b3068929eee149b4bd212685573ffffffffffffffffffffffffffffffffffffffff8516600090815260208190526040812054869160ff90911615159003610bae576040517f0368cdc700000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b6040517f70a08231000000000000000000000000000000000000000000000000000000008152306004820152879060009073ffffffffffffffffffffffffffffffffffffffff8316906370a0823190602401602060405180830381865afa158015610c1d573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610c419190611b41565b9050610c4f8a3330886113fd565b610c5e8a896109ab8789611b28565b6000808973ffffffffffffffffffffffffffffffffffffffff16348a8a604051610c89929190611b5a565b60006040518083038185875af1925050503d8060008114610cc6576040519150601f19603f3d011682016040523d82523d6000602084013e610ccb565b606091505b5091509150610cda82826112db565b6040517fdd62ed3e00000000000000000000000000000000000000000000000000000000815230600482015273ffffffffffffffffffffffffffffffffffffffff8b811660248301528d169063dd62ed3e90604401602060405180830381865afa158015610d4c573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610d709190611b41565b15610da7576040517f9d3e187d00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b6040517f70a0823100000000000000000000000000000000000000000000000000000000815230600482015260009073ffffffffffffffffffffffffffffffffffffffff8616906370a0823190602401602060405180830381865afa158015610e14573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610e389190611b41565b9050808410610e73576040517fa1d4e4dd00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b610e828c336105fc8785611b28565b5050505050503868929eee149b4bd212685550505050505050565b3068929eee149b4bd212685403610ebc5763ab143c066000526004601cfd5b3068929eee149b4bd212685573ffffffffffffffffffffffffffffffffffffffff8516600090815260208190526040812054869160ff90911615159003610f2f576040517f0368cdc700000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b6000610f3b3447611b28565b9050610f49883330876113fd565b610f5488888661145a565b6000808873ffffffffffffffffffffffffffffffffffffffff16348989604051610f7f929190611b5a565b60006040518083038185875af1925050503d8060008114610fbc576040519150601f19603f3d011682016040523d82523d6000602084013e610fc1565b606091505b5091509150610fd082826112db565b6040517fdd62ed3e00000000000000000000000000000000000000000000000000000000815230600482015273ffffffffffffffffffffffffffffffffffffffff8a811660248301528b169063dd62ed3e90604401602060405180830381865afa158015611042573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906110669190611b41565b1561109d576040517f9d3e187d00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b478381116110d7576040517fa1d4e4dd00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b60006110e38583611b28565b9050861561111b5761111633670de0b6b3a76400006111028a85611c2d565b61110c9190611c44565b6106259084611b28565b61112b565b801561112b5761112b338261133c565b5050505050503868929eee149b4bd2126855505050505050565b3068929eee149b4bd2126854036111645763ab143c066000526004601cfd5b3068929eee149b4bd212685573ffffffffffffffffffffffffffffffffffffffff8416600090815260208190526040812054859160ff909116151590036111d7576040517f0368cdc700000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b60006111e38334611b28565b90506000808773ffffffffffffffffffffffffffffffffffffffff16838888604051611210929190611b5a565b60006040518083038185875af1925050503d806000811461124d576040519150601f19603f3d011682016040523d82523d6000602084013e611252565b606091505b509150915061126182826112db565b505050503868929eee149b4bd212685550505050565b61127f611358565b63389a75e1600c52806000526020600c2080544211156112a757636f5e88186000526004601cfd5b60009055610b198161138e565b6112bc611358565b8060601b6112d257637448fbae6000526004601cfd5b610b198161138e565b816112e9576112e981611521565b5050565b81601452806034526fa9059cbb00000000000000000000000060005260206000604460106000875af13d156001600051141716611332576390b8ec186000526004601cfd5b6000603452505050565b60003860003884865af16112e95763b12d13eb6000526004601cfd5b7fffffffffffffffffffffffffffffffffffffffffffffffffffffffff74873927543314610733576382b429006000526004601cfd5b7fffffffffffffffffffffffffffffffffffffffffffffffffffffffff74873927805473ffffffffffffffffffffffffffffffffffffffff9092169182907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e0600080a3811560ff1b8217905550565b60405181606052826040528360601b602c526f23b872dd000000000000000000000000600c52602060006064601c6000895af13d15600160005114171661144c57637939f4246000526004601cfd5b600060605260405250505050565b81601452806034526f095ea7b300000000000000000000000060005260206000604460106000875af13d15600160005114171661133257633e3f8f736000526004601cfd5b7fffffffffffffffffffffffffffffffffffffffffffffffffffffffff748739278054156114d557630dc149f06000526004601cfd5b73ffffffffffffffffffffffffffffffffffffffff909116801560ff1b81179091558060007f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e08180a350565b60048151101561155d576040517fc07fe60f00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b60208101517fb1b7848f000000000000000000000000000000000000000000000000000000007fffffffff0000000000000000000000000000000000000000000000000000000082160161163f57604080518082018252601b81527f506c7567436f72653a7461726765742d70616e69636b65642d30780000000000602082018181526024860151600481811c600f908116603090810160081b918416011790931790915292517f08c379a000000000000000000000000000000000000000000000000000000000815291929161163691849101611c7f565b60405180910390fd5b81518060208401fd5b73ffffffffffffffffffffffffffffffffffffffff81168114610b1957600080fd5b60008083601f84011261167c57600080fd5b50813567ffffffffffffffff81111561169457600080fd5b6020830191508360208285010111156116ac57600080fd5b9250929050565b6000806000806000608086880312156116cb57600080fd5b85356116d681611648565b945060208601356116e681611648565b9350604086013567ffffffffffffffff81111561170257600080fd5b61170e8882890161166a565b96999598509660600135949350505050565b60006020828403121561173257600080fd5b813561173d81611648565b9392505050565b60008083601f84011261175657600080fd5b50813567ffffffffffffffff81111561176e57600080fd5b6020830191508360208260051b85010111156116ac57600080fd5b60008060006040848603121561179e57600080fd5b833567ffffffffffffffff8111156117b557600080fd5b6117c186828701611744565b909450925050602084013580151581146117da57600080fd5b809150509250925092565b600080600080600080606087890312156117fe57600080fd5b863567ffffffffffffffff8082111561181657600080fd5b6118228a838b01611744565b9098509650602089013591508082111561183b57600080fd5b6118478a838b01611744565b9096509450604089013591508082111561186057600080fd5b5061186d89828a01611744565b979a9699509497509295939492505050565b6000815180845260005b818110156118a557602081850181015186830182015201611889565b5060006020828601015260207fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0601f83011685010191505092915050565b604080825283519082018190526000906020906060840190828701845b8281101561191e578151151584529284019290840190600101611900565b50505083810382850152845180825282820190600581901b8301840187850160005b8381101561198c577fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe086840301855261197a83835161187f565b94870194925090860190600101611940565b50909998505050505050505050565b60008060008060008060a087890312156119b457600080fd5b86356119bf81611648565b955060208701356119cf81611648565b9450604087013567ffffffffffffffff8111156119eb57600080fd5b6119f789828a0161166a565b979a9699509760608101359660809091013595509350505050565b600080600080600080600060c0888a031215611a2d57600080fd5b8735611a3881611648565b96506020880135611a4881611648565b95506040880135611a5881611648565b9450606088013567ffffffffffffffff811115611a7457600080fd5b611a808a828b0161166a565b989b979a50959895979660808701359660a0013595509350505050565b60008060008060608587031215611ab357600080fd5b8435611abe81611648565b9350602085013567ffffffffffffffff811115611ada57600080fd5b611ae68782880161166a565b9598909750949560400135949350505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b81810381811115611b3b57611b3b611af9565b92915050565b600060208284031215611b5357600080fd5b5051919050565b8183823760009101908152919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b60008083357fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe1843603018112611bfd57600080fd5b83018035915067ffffffffffffffff821115611c1857600080fd5b6020019150368190038213156116ac57600080fd5b8082028115828204841417611b3b57611b3b611af9565b600082611c7a577f4e487b7100000000000000000000000000000000000000000000000000000000600052601260045260246000fd5b500490565b60208152600061173d602083018461187f56fea164736f6c6343000817000a";

    bytes32 internal constant PLUG_TREASURY_SALT =
        0x000000000000000000000000000000000000000011b6eff9eee3ff3f3ed4b63a;

    address internal constant PLUG_TREASURY_ADDRESS = 0x00b35Ab3ad8526b1aF6b60Aa0A7c7f276644ED43;

    bytes internal constant PLUG_VAULT_SOCKET_INITCODE =
        hex"60a06040523060805234801561001457600080fd5b5061001f6001610024565b61006c565b61002d81610030565b50565b6001600160a01b0316638b78c6d8198190558060007f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e08180a350565b6080516122ff6200008f600039600081816106c101526107a701526122ff6000f3fe60806040526004361061018f5760003560e01c8063873177f6116100d6578063c98fb8831161007f578063f2fde38b11610059578063f2fde38b1461045d578063f91d053814610470578063fee81cf41461049057610196565b8063c98fb88314610414578063dfe86ac514610434578063f04e283e1461044a57610196565b8063b21be2b0116100b0578063b21be2b0146103bf578063c2fb26a6146103d2578063c4d66de8146103f457610196565b8063873177f6146103505780638da5cb5b1461037057806395d89b41146103aa57610196565b806352d1902d116101385780636c48c62e116101125780636c48c62e14610308578063715018a6146103285780637328827c1461033057610196565b806352d1902d146102a557806354d1f13d146102ba57806354fd4d50146102c257610196565b806334bb37001161016957806334bb37001461024457806342345d97146102725780634f1ef2861461029257610196565b806306fdde03146101c45780632277c34f1461021c578063256929621461023c57610196565b3661019657005b60003560e01c63bc197c81811463f23a6e6182141763150b7a02821417156101c257806020526020603cf35b005b3480156101d057600080fd5b5060408051808201909152601181527f506c7567205661756c7420536f636b657400000000000000000000000000000060208201525b60405161021391906117e7565b60405180910390f35b61022f61022a366004611823565b6104c3565b6040516102139190611882565b6101c261055e565b34801561025057600080fd5b5061026461025f366004611a4d565b6105ae565b604051908152602001610213565b34801561027e57600080fd5b5061026461028d366004611b84565b61064d565b6101c26102a0366004611bc1565b6106bf565b3480156102b157600080fd5b506102646107a3565b6101c2610802565b3480156102ce57600080fd5b5060408051808201909152600581527f302e302e310000000000000000000000000000000000000000000000000000006020820152610206565b34801561031457600080fd5b50610264610323366004611d86565b61083e565b6101c26108cc565b34801561033c57600080fd5b5061026461034b366004611d86565b6108e0565b34801561035c57600080fd5b5061026461036b366004611dbb565b61092b565b34801561037c57600080fd5b50638b78c6d819545b60405173ffffffffffffffffffffffffffffffffffffffff9091168152602001610213565b3480156103b657600080fd5b506102066109be565b61022f6103cd366004611df0565b610a78565b3480156103de57600080fd5b506103e7610b0e565b6040516102139190611e2b565b34801561040057600080fd5b506101c261040f366004611eb9565b610bde565b34801561042057600080fd5b5061026461042f366004611ed6565b610bea565b34801561044057600080fd5b5061026460005481565b6101c2610458366004611eb9565b610c46565b6101c261046b366004611eb9565b610c83565b34801561047c57600080fd5b5061038561048b366004611ed6565b610caa565b34801561049c57600080fd5b506102646104ab366004611eb9565b63389a75e1600c908152600091909152602090205490565b6060836104cf81610ccd565b151560000361050a576040517f37e8456b00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b3068929eee149b4bd2126854036105295763ab143c066000526004601cfd5b3068929eee149b4bd21268556105496105428680611f7d565b8585610f8c565b3868929eee149b4bd212685595945050505050565b60006202a30067ffffffffffffffff164201905063389a75e1600c5233600052806020600c2055337fdbf36a107da19e49527a7176a1babf963b4b0ff8cde35ee35d6cd8f1f9ac7e1d600080a250565b805180516020918201208183015180519083012060408085015160608087015183517f8b73c3c69bb8fe3d512ecc4cf759cc79239f7b179b0ffacaa9a75d522b39400f978101979097529286019490945292840191909152608083019190915273ffffffffffffffffffffffffffffffffffffffff1660a082015260009060c0015b604051602081830303815290604052805190602001209050919050565b805160208083015160408085015180519084012081517f0d73e94823fdaacb148d9146f00bc268b7834e768ced483d796db05a52e1e3959481019490945273ffffffffffffffffffffffffffffffffffffffff909416908301526060820152608081019190915260009060a001610630565b7f00000000000000000000000000000000000000000000000000000000000000003081036106f557639f03a0266000526004601cfd5b6106fe84611448565b8360601b60601c93506352d1902d6001527f360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc80602060016004601d895afa5114610750576355299b496001526004601dfd5b847fbc7cd75a20ee27fd9adebab32041f755214dbc6bffa90cc0225b39da2e5c2d3b600038a2849055811561079d57604051828482376000388483885af461079b573d6000823e3d81fd5b505b50505050565b60007f00000000000000000000000000000000000000000000000000000000000000003081146107db57639f03a0266000526004601cfd5b7f360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc91505090565b63389a75e1600c523360005260006020600c2055337ffa7b8eab7da67f412cc9575ed43464468f9bfbae89d1675917346ca6d8fe3c92600080a2565b805160208201516000917fab17334cacf66e0b0c0e533c2822a50549311ba957ec52ec037e1c8083f023ab916108739061092b565b846040015180519060200120856060015160405160200161063095949392919094855273ffffffffffffffffffffffffffffffffffffffff93909316602085015260408401919091526060830152608082015260a00190565b6108d461144c565b6108de6000611467565b565b600080546108ed8361083e565b6040517f1901000000000000000000000000000000000000000000000000000000000000602082015260228101929092526042820152606201610630565b60006060600080845190505b808210156109ae578261096286848151811061095557610955611fbb565b602002602001015161064d565b604051602001610973929190611fea565b604080517fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe08184030181529190529250600190910190610937565b5050805160209091012092915050565b606060006109fc60408051808201909152601181527f506c7567205661756c7420536f636b6574000000000000000000000000000000602082015290565b9050805160405181815260208301602082016000805b85811015610a44578084015160001a605b8110604082111615610a3b5780838501536001830192505b50600101610a12565b506005811115610a52575060055b80610a63575064504c554753815260045b80845283016020016040525090949350505050565b6060610a83336114b2565b1515600003610ac5576040517fee2a806a0000000000000000000000000000000000000000000000000000000081523360048201526024015b60405180910390fd5b3068929eee149b4bd212685403610ae45763ab143c066000526004601cfd5b3068929eee149b4bd2126855610afc82600080610f8c565b3868929eee149b4bd212685592915050565b610b4f6040518060800160405280606081526020016060815260200160008152602001600073ffffffffffffffffffffffffffffffffffffffff1681525090565b6040805160c081019091526011608082019081527f506c7567205661756c7420536f636b657400000000000000000000000000000060a083015281908152602001610bca60408051808201909152600581527f302e302e31000000000000000000000000000000000000000000000000000000602082015290565b815246602082015230604090910152919050565b610be781611514565b50565b80516000907f6cd9425d5dd731a623cc0fee82dd49189fd54b9a5d85856406fe9744411d915790610c1a9061083e565b602080850151805190820120604051610630949392019283526020830191909152604082015260600190565b610c4e61144c565b63389a75e1600c52806000526020600c208054421115610c7657636f5e88186000526004601cfd5b60009055610be781611467565b610c8b61144c565b8060601b610ca157637448fbae6000526004601cfd5b610be781611467565b6000610cc78260200151610cc184600001516108e0565b9061155d565b92915050565b600080610cdd602084018461200c565b6000818110610cee57610cee611fbb565b7fff000000000000000000000000000000000000000000000000000000000000009201359182169250507f030000000000000000000000000000000000000000000000000000000000000016819003610ddf57610d9e610d51602085018561200c565b8080601f016020809104026020016040519081016040528093929190818152602001838380828437600092019190915250610cc19250610d95915087905080611f7d565b61034b90612078565b73ffffffffffffffffffffffffffffffffffffffff16610dc1638b78c6d8195490565b73ffffffffffffffffffffffffffffffffffffffff16149150610f86565b7fff0000000000000000000000000000000000000000000000000000000000000081167f0400000000000000000000000000000000000000000000000000000000000000821603610f865760008080610e3b602087018761200c565b610e49916001908290612084565b810190610e5691906120ae565b91945092509050610e7d8284610e78610e6f8a80611f7d565b61032390612078565b611607565b1515600003610eb8576040517f7fcdd1f400000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b600082516020610ec891906121a1565b610ed39060a16121b8565b9050610f45610ee5602089018961200c565b8390855185610ef491906121b8565b92610f0193929190612084565b8080601f016020809104026020016040519081016040528093929190818152602001838380828437600092019190915250610cc19250610d9591508b905080611f7d565b73ffffffffffffffffffffffffffffffffffffffff16610f68638b78c6d8195490565b73ffffffffffffffffffffffffffffffffffffffff16149550505050505b50919050565b60606000610f9c61032386612078565b90506000610fad60208701876121cb565b905090508067ffffffffffffffff811115610fca57610fca611918565b60405190808252806020026020018201604052801561101057816020015b604080518082019091526000815260606020820152815260200190600190039081610fe85790505b5092503660005b828110156111eb5761102c60208901896121cb565b8281811061103c5761103c611fbb565b905060200281019061104e9190612233565b915081602001354710156110c4576110696020830183611eb9565b6040517fee4c264a00000000000000000000000000000000000000000000000000000000815273ffffffffffffffffffffffffffffffffffffffff909116600482015260208301356024820152476044820152606401610abc565b6110d16020830183611eb9565b73ffffffffffffffffffffffffffffffffffffffff1660208301356110f9604085018561200c565b611107916001908290612084565b604051611115929190612267565b60006040518083038185875af1925050503d8060008114611152576040519150601f19603f3d011682016040523d82523d6000602084013e611157565b606091505b5086838151811061116a5761116a611fbb565b602002602001015160000187848151811061118757611187611fbb565b6020026020010151602001829052821515151581525050506111e38582815181106111b4576111b4611fbb565b6020026020010151600001518683815181106111d2576111d2611fbb565b602002602001015160200151611649565b600101611017565b506111f9604088018861200c565b159050611406576000808061121160408b018b61200c565b81019061121e9190612298565b9250925092508873ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff16146112a9576040517f305083d100000000000000000000000000000000000000000000000000000000815273ffffffffffffffffffffffffffffffffffffffff80831660048301528a166024820152604401610abc565b60006112c3486bffffffffffffffffffffffff86166121b8565b9050836bffffffffffffffffffffffff16836bffffffffffffffffffffffff16146113175780836bffffffffffffffffffffffff16106113035780611327565b826bffffffffffffffffffffffff16611327565b826bffffffffffffffffffffffff165b9050805a611335908b6122df565b61133f91906121a1565b905060008273ffffffffffffffffffffffffffffffffffffffff168260405160006040518083038185875af1925050503d806000811461139b576040519150601f19603f3d011682016040523d82523d6000602084013e6113a0565b606091505b5090915050801515600003611400576040517ff4614d4700000000000000000000000000000000000000000000000000000000815273ffffffffffffffffffffffffffffffffffffffff8416600482015260248101839052604401610abc565b50505050505b827f1b172e1ca2420139949ea1dad2ca52a97c8096c3b77aac120095b04cdf1b212f856040516114369190611882565b60405180910390a25050509392505050565b610be75b638b78c6d8195433146108de576382b429006000526004601cfd5b638b78c6d819805473ffffffffffffffffffffffffffffffffffffffff9092169182907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e0600080a355565b60006114c1638b78c6d8195490565b73ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff161480610cc7575073ffffffffffffffffffffffffffffffffffffffff8216301492915050565b73ffffffffffffffffffffffffffffffffffffffff16638b78c6d8198190558060007f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e08180a350565b60405160019083600052602083015160405260408351036115b257604083015160ff81901c601b016020527f7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff166060526115d8565b60418351036115d357606083015160001a60205260408301516060526115d8565b600091505b6020600160806000855afa5191503d6115f957638baa579f6000526004601cfd5b600060605260405292915050565b60008351156116425760208401845160051b81015b8151841160051b93845281516020948518526040600020939091019080821061161c5750505b5014919050565b81611657576116578161165b565b5050565b600481511015611697576040517fc07fe60f00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b60208101517fb1b7848f000000000000000000000000000000000000000000000000000000007fffffffff0000000000000000000000000000000000000000000000000000000082160161177057604080518082018252601b81527f506c7567436f72653a7461726765742d70616e69636b65642d30780000000000602082018181526024860151600481811c600f908116603090810160081b918416011790931790915292517f08c379a0000000000000000000000000000000000000000000000000000000008152919291610abc918491016117e7565b81518060208401fd5b60005b8381101561179457818101518382015260200161177c565b50506000910152565b600081518084526117b5816020860160208601611779565b601f017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0169290920160200192915050565b6020815260006117fa602083018461179d565b9392505050565b73ffffffffffffffffffffffffffffffffffffffff81168114610be757600080fd5b60008060006060848603121561183857600080fd5b833567ffffffffffffffff81111561184f57600080fd5b84016040818703121561186157600080fd5b9250602084013561187181611801565b929592945050506040919091013590565b600060208083018184528085518083526040925060408601915060408160051b87010184880160005b8381101561190a578883037fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc001855281518051151584528701518784018790526118f78785018261179d565b95880195935050908601906001016118ab565b509098975050505050505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6040516080810167ffffffffffffffff8111828210171561196a5761196a611918565b60405290565b604051601f82017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe016810167ffffffffffffffff811182821017156119b7576119b7611918565b604052919050565b600082601f8301126119d057600080fd5b813567ffffffffffffffff8111156119ea576119ea611918565b611a1b60207fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0601f84011601611970565b818152846020838601011115611a3057600080fd5b816020850160208301376000918101602001919091529392505050565b600060208284031215611a5f57600080fd5b813567ffffffffffffffff80821115611a7757600080fd5b9083019060808286031215611a8b57600080fd5b611a93611947565b823582811115611aa257600080fd5b611aae878286016119bf565b825250602083013582811115611ac357600080fd5b611acf878286016119bf565b6020830152506040830135604082015260608301359250611aef83611801565b6060810192909252509392505050565b600060608284031215611b1157600080fd5b6040516060810167ffffffffffffffff8282108183111715611b3557611b35611918565b8160405282935084359150611b4982611801565b818352602085013560208401526040850135915080821115611b6a57600080fd5b50611b77858286016119bf565b6040830152505092915050565b600060208284031215611b9657600080fd5b813567ffffffffffffffff811115611bad57600080fd5b611bb984828501611aff565b949350505050565b600080600060408486031215611bd657600080fd5b8335611be181611801565b9250602084013567ffffffffffffffff80821115611bfe57600080fd5b818601915086601f830112611c1257600080fd5b813581811115611c2157600080fd5b876020828501011115611c3357600080fd5b6020830194508093505050509250925092565b600067ffffffffffffffff821115611c6057611c60611918565b5060051b60200190565b600082601f830112611c7b57600080fd5b81356020611c90611c8b83611c46565b611970565b82815260059290921b84018101918181019086841115611caf57600080fd5b8286015b84811015611cef57803567ffffffffffffffff811115611cd35760008081fd5b611ce18986838b0101611aff565b845250918301918301611cb3565b509695505050505050565b600060808284031215611d0c57600080fd5b611d14611947565b90508135611d2181611801565b8152602082013567ffffffffffffffff80821115611d3e57600080fd5b611d4a85838601611c6a565b60208401526040840135915080821115611d6357600080fd5b50611d70848285016119bf565b6040830152506060820135606082015292915050565b600060208284031215611d9857600080fd5b813567ffffffffffffffff811115611daf57600080fd5b611bb984828501611cfa565b600060208284031215611dcd57600080fd5b813567ffffffffffffffff811115611de457600080fd5b611bb984828501611c6a565b600060208284031215611e0257600080fd5b813567ffffffffffffffff811115611e1957600080fd5b8201608081850312156117fa57600080fd5b602081526000825160806020840152611e4760a084018261179d565b905060208401517fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0848303016040850152611e82828261179d565b9150506040840151606084015273ffffffffffffffffffffffffffffffffffffffff60608501511660808401528091505092915050565b600060208284031215611ecb57600080fd5b81356117fa81611801565b600060208284031215611ee857600080fd5b813567ffffffffffffffff80821115611f0057600080fd5b9083019060408286031215611f1457600080fd5b604051604081018181108382111715611f2f57611f2f611918565b604052823582811115611f4157600080fd5b611f4d87828601611cfa565b825250602083013582811115611f6257600080fd5b611f6e878286016119bf565b60208301525095945050505050565b600082357fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff81833603018112611fb157600080fd5b9190910192915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b60008351611ffc818460208801611779565b9190910191825250602001919050565b60008083357fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe184360301811261204157600080fd5b83018035915067ffffffffffffffff82111561205c57600080fd5b60200191503681900382131561207157600080fd5b9250929050565b6000610cc73683611cfa565b6000808585111561209457600080fd5b838611156120a157600080fd5b5050820193919092039150565b6000806000606084860312156120c357600080fd5b8335925060208085013567ffffffffffffffff808211156120e357600080fd5b818701915087601f8301126120f757600080fd5b8135612105611c8b82611c46565b81815260059190911b8301840190848101908a83111561212457600080fd5b938501935b8285101561214257843582529385019390850190612129565b96505050604087013592508083111561215a57600080fd5b5050612168868287016119bf565b9150509250925092565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b8082028115828204841417610cc757610cc7612172565b80820180821115610cc757610cc7612172565b60008083357fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe184360301811261220057600080fd5b83018035915067ffffffffffffffff82111561221b57600080fd5b6020019150600581901b360382131561207157600080fd5b600082357fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa1833603018112611fb157600080fd5b8183823760009101908152919050565b80356bffffffffffffffffffffffff8116811461229357600080fd5b919050565b6000806000606084860312156122ad57600080fd5b6122b684612277565b92506122c460208501612277565b915060408401356122d481611801565b809150509250925092565b81810381811115610cc757610cc761217256fea164736f6c6343000817000a";

    bytes32 internal constant PLUG_VAULT_SOCKET_SALT =
        0x00000000000000000000000000000000000000003a91aec272c9ff3f655e1dc1;

    address internal constant PLUG_VAULT_SOCKET_ADDRESS = 0x00e95ac816caeB69e96E19d4ED890F3001Fc3edA;

    bytes internal constant PLUG_INITCODE =
        hex"6080604052600080546001600160a01b0319167236e76d47ab763104bb03d400973db646838fad17905534801561003557600080fd5b50610c1c806100456000396000f3fe60806040526004361061003f5760003560e01c806306fdde031461004457806337b22d2b1461009c57806395d89b41146100bc578063b4ddf36114610102575b600080fd5b34801561005057600080fd5b5060408051808201909152600481527f506c75670000000000000000000000000000000000000000000000000000000060208201525b6040516100939190610416565b60405180910390f35b6100af6100aa366004610430565b610122565b60405161009391906104d9565b3480156100c857600080fd5b5060408051808201909152600481527f504c5547000000000000000000000000000000000000000000000000000000006020820152610086565b6101156101103660046104ec565b6101b6565b6040516100939190610561565b606061012d8261026a565b73ffffffffffffffffffffffffffffffffffffffff16632277c34f83335a6040518463ffffffff1660e01b81526004016101699392919061076f565b6000604051808303816000875af1158015610188573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f191682016040526101b091908101906109bc565b92915050565b60606000828067ffffffffffffffff8111156101d4576101d461091e565b60405190808252806020026020018201604052801561020757816020015b60608152602001906001900390816101f25790505b5092505b808210156102625761023a85858481811061022857610228610b1a565b90506020028101906100aa9190610b49565b83838151811061024c5761024c610b1a565b602090810291909101015260019091019061020b565b505092915050565b6000806102778380610b87565b610285906020810190610bbb565b90508073ffffffffffffffffffffffffffffffffffffffff163b6000036101b0576000805473ffffffffffffffffffffffffffffffffffffffff16632b85ba386102cf8680610b87565b606001356040518263ffffffff1660e01b81526004016102f191815260200190565b60408051808303816000875af115801561030f573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906103339190610bd8565b9150508073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff16146103bf576040517f5a4be8f400000000000000000000000000000000000000000000000000000000815273ffffffffffffffffffffffffffffffffffffffff80841660048301528216602482015260440160405180910390fd5b5092915050565b60005b838110156103e15781810151838201526020016103c9565b50506000910152565b600081518084526104028160208601602086016103c6565b601f01601f19169290920160200192915050565b60208152600061042960208301846103ea565b9392505050565b60006020828403121561044257600080fd5b813567ffffffffffffffff81111561045957600080fd5b82016040818503121561042957600080fd5b600082825180855260208086019550808260051b84010181860160005b848110156104cc57858303601f19018952815180511515845284015160408585018190526104b8818601836103ea565b9a86019a9450505090830190600101610488565b5090979650505050505050565b602081526000610429602083018461046b565b600080602083850312156104ff57600080fd5b823567ffffffffffffffff8082111561051757600080fd5b818501915085601f83011261052b57600080fd5b81358181111561053a57600080fd5b8660208260051b850101111561054f57600080fd5b60209290920196919550909350505050565b600060208083016020845280855180835260408601915060408160051b87010192506020870160005b828110156105d6577fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc08886030184526105c485835161046b565b9450928501929085019060010161058a565b5092979650505050505050565b73ffffffffffffffffffffffffffffffffffffffff8116811461060557600080fd5b50565b60008083357fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe184360301811261063d57600080fd5b830160208101925035905067ffffffffffffffff81111561065d57600080fd5b80360382131561066c57600080fd5b9250929050565b818352818160208501375060006020828401015260006020601f19601f840116840101905092915050565b60008383855260208086019550808560051b830101846000805b8881101561076157601f19868503018a5282357fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa18936030181126106fa578283fd5b880160608135610709816105e3565b73ffffffffffffffffffffffffffffffffffffffff1686528187013587870152604061073781840184610608565b9350828289015261074b8389018583610673565b9d89019d975050509386019350506001016106b8565b509198975050505050505050565b60608152600084357fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff818636030181126107a757600080fd5b60406060840152850180356107bb816105e3565b73ffffffffffffffffffffffffffffffffffffffff1660a08401526020810135368290037fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe101811261080c57600080fd5b810160208101903567ffffffffffffffff81111561082957600080fd5b8060051b360382131561083b57600080fd5b608060c08601526108516101208601828461069e565b9150506108616040830183610608565b7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff608684030160e0870152610896838284610673565b9250505060608201356101008501526108b26020880188610608565b92507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa08583030160808601526108e9828483610673565b9350505050610910602083018573ffffffffffffffffffffffffffffffffffffffff169052565b826040830152949350505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6040805190810167ffffffffffffffff811182821017156109705761097061091e565b60405290565b604051601f8201601f1916810167ffffffffffffffff8111828210171561099f5761099f61091e565b604052919050565b805180151581146109b757600080fd5b919050565b600060208083850312156109cf57600080fd5b825167ffffffffffffffff808211156109e757600080fd5b818501915085601f8301126109fb57600080fd5b815181811115610a0d57610a0d61091e565b8060051b610a1c858201610976565b9182528381018501918581019089841115610a3657600080fd5b86860192505b83831015610b0d57825185811115610a545760008081fd5b86016040601f19828d038101821315610a6d5760008081fd5b610a7561094d565b610a808b85016109a7565b81528284015189811115610a945760008081fd5b8085019450508d603f850112610aaa5760008081fd5b8a84015189811115610abe57610abe61091e565b610ace8c84601f84011601610976565b92508083528e84828701011115610ae55760008081fd5b610af4818d85018688016103c6565b50808b0191909152845250509186019190860190610a3c565b9998505050505050505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b600082357fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc1833603018112610b7d57600080fd5b9190910192915050565b600082357fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff81833603018112610b7d57600080fd5b600060208284031215610bcd57600080fd5b8135610429816105e3565b60008060408385031215610beb57600080fd5b610bf4836109a7565b91506020830151610c04816105e3565b80915050925092905056fea164736f6c6343000817000a";

    bytes32 internal constant PLUG_SALT =
        0x0000000000000000000000000000000000000000eae2148142f1ff3fb8e4895a;

    address internal constant PLUG_ADDRESS = 0x3Ac8CF338Ab858Bc006Fe96bF2C27bBa00Eb4918;

    /**
     * @notice Deploy (if needed) and return the PlugFactory contract instance.
     * @return $plugFactory The PlugFactory contract instance.
     */
    function plugFactory() internal returns (PlugFactory $plugFactory) {
        require(
            keccak256(abi.encodePacked(type(PlugFactory).creationCode))
                == keccak256(abi.encodePacked(PLUG_FACTORY_INITCODE)),
            "PlugEtcherLib:invalid-initcode"
        );

        if (_extcodesize(PLUG_FACTORY_ADDRESS) == 0) {
            address reality = safeCreate2(PLUG_FACTORY_SALT, PLUG_FACTORY_INITCODE);
            require(reality == PLUG_FACTORY_ADDRESS, "PlugEtcherLib:unexpected-address");
        }

        $plugFactory = PlugFactory(payable(PLUG_FACTORY_ADDRESS));
    }

    /**
     * @notice Deploy (if needed) and return the PlugTreasury contract instance.
     * @return $plugTreasury The PlugTreasury contract instance.
     */
    function plugTreasury() internal returns (PlugTreasury $plugTreasury) {
        require(
            keccak256(abi.encodePacked(type(PlugTreasury).creationCode))
                == keccak256(abi.encodePacked(PLUG_TREASURY_INITCODE)),
            "PlugEtcherLib:invalid-initcode"
        );

        if (_extcodesize(PLUG_TREASURY_ADDRESS) == 0) {
            address reality = safeCreate2(PLUG_TREASURY_SALT, PLUG_TREASURY_INITCODE);
            require(reality == PLUG_TREASURY_ADDRESS, "PlugEtcherLib:unexpected-address");
        }

        $plugTreasury = PlugTreasury(payable(PLUG_TREASURY_ADDRESS));
    }

    /**
     * @notice Deploy (if needed) and return the PlugVaultSocket contract instance.
     * @return $plugVaultSocket The PlugVaultSocket contract instance.
     */
    function plugVaultSocket() internal returns (PlugVaultSocket $plugVaultSocket) {
        require(
            keccak256(abi.encodePacked(type(PlugVaultSocket).creationCode))
                == keccak256(abi.encodePacked(PLUG_VAULT_SOCKET_INITCODE)),
            "PlugEtcherLib:invalid-initcode"
        );

        if (_extcodesize(PLUG_VAULT_SOCKET_ADDRESS) == 0) {
            address reality = safeCreate2(PLUG_VAULT_SOCKET_SALT, PLUG_VAULT_SOCKET_INITCODE);
            require(reality == PLUG_VAULT_SOCKET_ADDRESS, "PlugEtcherLib:unexpected-address");
        }

        $plugVaultSocket = PlugVaultSocket(payable(PLUG_VAULT_SOCKET_ADDRESS));
    }

    /**
     * @notice Deploy (if needed) and return the Plug contract instance.
     * @return $plug The Plug contract instance.
     */
    function plug() internal returns (Plug $plug) {
        require(
            keccak256(abi.encodePacked(type(Plug).creationCode))
                == keccak256(abi.encodePacked(PLUG_INITCODE)),
            "PlugEtcherLib:invalid-initcode"
        );

        if (_extcodesize(PLUG_ADDRESS) == 0) {
            address reality = safeCreate2(PLUG_SALT, PLUG_INITCODE);
            require(reality == PLUG_ADDRESS, "PlugEtcherLib:unexpected-address");
        }

        $plug = Plug(payable(PLUG_ADDRESS));
    }

    /**
     * @notice Deploys a contract via 0age's immutable create 2 factory for testing.
     * @param $salt The salt to use for the deployment.
     * @param $initializationCode The initialization code for the contract.
     * @return $deployment The address of the deployed contract.
     */
    function safeCreate2(
        bytes32 $salt,
        bytes memory $initializationCode
    )
        public
        returns (address $deployment)
    {
        // Canonical address of 0age's immutable create 2 factory.
        address c2f = 0x0000000000FFe8B47B3e2130213B802212439497;
        if (_extcodesize(c2f) == 0) {
            bytes memory ic2fBytecode =
                hex"60806040526004361061003f5760003560e01c806308508b8f1461004457806364e030871461009857806385cf97ab14610138578063a49a7c90146101bc575b600080fd5b34801561005057600080fd5b506100846004803603602081101561006757600080fd5b503573ffffffffffffffffffffffffffffffffffffffff166101ec565b604080519115158252519081900360200190f35b61010f600480360360408110156100ae57600080fd5b813591908101906040810160208201356401000000008111156100d057600080fd5b8201836020820111156100e257600080fd5b8035906020019184600183028401116401000000008311171561010457600080fd5b509092509050610217565b6040805173ffffffffffffffffffffffffffffffffffffffff9092168252519081900360200190f35b34801561014457600080fd5b5061010f6004803603604081101561015b57600080fd5b8135919081019060408101602082013564010000000081111561017d57600080fd5b82018360208201111561018f57600080fd5b803590602001918460018302840111640100000000831117156101b157600080fd5b509092509050610592565b3480156101c857600080fd5b5061010f600480360360408110156101df57600080fd5b508035906020013561069e565b73ffffffffffffffffffffffffffffffffffffffff1660009081526020819052604090205460ff1690565b600083606081901c33148061024c57507fffffffffffffffffffffffffffffffffffffffff0000000000000000000000008116155b6102a1576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260458152602001806107746045913960600191505060405180910390fd5b606084848080601f0160208091040260200160405190810160405280939291908181526020018383808284376000920182905250604051855195965090943094508b93508692506020918201918291908401908083835b6020831061033557805182527fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe090920191602091820191016102f8565b51815160209384036101000a7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff018019909216911617905260408051929094018281037fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe00183528085528251928201929092207fff000000000000000000000000000000000000000000000000000000000000008383015260609890981b7fffffffffffffffffffffffffffffffffffffffff00000000000000000000000016602183015260358201969096526055808201979097528251808203909701875260750182525084519484019490942073ffffffffffffffffffffffffffffffffffffffff81166000908152938490529390922054929350505060ff16156104a7576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252603f815260200180610735603f913960400191505060405180910390fd5b81602001825188818334f5955050508073ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff161461053a576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260468152602001806107b96046913960600191505060405180910390fd5b50505073ffffffffffffffffffffffffffffffffffffffff8116600090815260208190526040902080547fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff001660011790559392505050565b6000308484846040516020018083838082843760408051919093018181037fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe001825280845281516020928301207fff000000000000000000000000000000000000000000000000000000000000008383015260609990991b7fffffffffffffffffffffffffffffffffffffffff000000000000000000000000166021820152603581019790975260558088019890985282518088039098018852607590960182525085519585019590952073ffffffffffffffffffffffffffffffffffffffff81166000908152948590529490932054939450505060ff909116159050610697575060005b9392505050565b604080517fff000000000000000000000000000000000000000000000000000000000000006020808301919091523060601b6021830152603582018590526055808301859052835180840390910181526075909201835281519181019190912073ffffffffffffffffffffffffffffffffffffffff81166000908152918290529190205460ff161561072e575060005b9291505056fe496e76616c696420636f6e7472616374206372656174696f6e202d20636f6e74726163742068617320616c7265616479206265656e206465706c6f7965642e496e76616c69642073616c74202d206669727374203230206279746573206f66207468652073616c74206d757374206d617463682063616c6c696e6720616464726573732e4661696c656420746f206465706c6f7920636f6e7472616374207573696e672070726f76696465642073616c7420616e6420696e697469616c697a6174696f6e20636f64652ea265627a7a723058202bdc55310d97c4088f18acf04253db593f0914059f0c781a9df3624dcef0d1cf64736f6c634300050a0032";
            /// @solidity memory-safe-assembly
            assembly {
                let m := mload(0x40)
                mstore(m, 0xb4d6c782) // `etch(address,bytes)`.
                mstore(add(m, 0x20), c2f)
                mstore(add(m, 0x40), 0x40)
                let n := mload(ic2fBytecode)
                mstore(add(m, 0x60), n)
                for { let i := 0 } lt(i, n) { i := add(0x20, i) } {
                    mstore(add(add(m, 0x80), i), mload(add(add(ic2fBytecode, 0x20), i)))
                }
                let vmAddress := 0x7109709ECfa91a80626fF3989D68f67F5b1DD12D
                if iszero(call(gas(), vmAddress, 0, add(m, 0x1c), add(n, 0x64), 0x00, 0x00)) {
                    revert(0, 0)
                }
            }
        }
        /// @solidity memory-safe-assembly
        assembly {
            let m := mload(0x40)
            let n := mload($initializationCode)
            mstore(m, 0x64e03087) // `safeCreate2(bytes32,bytes)`.
            mstore(add(m, 0x20), $salt)
            mstore(add(m, 0x40), 0x40)
            mstore(add(m, 0x60), n)
            // prettier-ignore
            for { let i := 0 } lt(i, n) { i := add(i, 0x20) } {
                mstore(add(add(m, 0x80), i), mload(add(add($initializationCode, 0x20), i)))
            }
            if iszero(call(gas(), c2f, 0, add(m, 0x1c), add(n, 0x64), m, 0x20)) {
                returndatacopy(m, m, returndatasize())
                revert(m, returndatasize())
            }
            $deployment := mload(m)
        }
    }

    /**
     * @notice Determine and retrieve the extcodesize of `deployment`.
     * @param $deployment The address to check.
     * @return $result The size of the code at `deployment`.
     */
    function _extcodesize(address $deployment) private view returns (uint256 $result) {
        /// @solidity memory-safe-assembly
        assembly {
            $result := extcodesize($deployment)
        }
    }
}
